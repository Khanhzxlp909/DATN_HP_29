<template>
  <div class="container">
    <!-- Sản phẩm -->
    <div class="product">
      <div class="container">
        <!-- Slideshow -->
        <div class="slideshow">
          <div id="demo" class="carousel slide" data-ride="carousel">
            <ul class="carousel-indicators">
              <li data-target="#demo" data-slide-to="0" class="active"></li>
              <li data-target="#demo" data-slide-to="1"></li>
              <li data-target="#demo" data-slide-to="2"></li>
            </ul>
            <div class="carousel-inner">
              <div v-for="(img, index) in [2,1,3]" :key="index" :class="['carousel-item', {active: index===0}]">
                <img :src="require(`@/assets/img/slideshow/${img}.jpg`)" :alt="`Slideshow Image ${index+1}`" width="1100" height="550"/>
                <div class="carousel-caption">
                  <a href="/product" class="click-slideshow">Xem chi tiết</a>
                </div>
              </div>
            </div>
            <a class="carousel-control-prev" href="#demo" data-slide="prev">
              <span class="carousel-control-prev-icon"></span>
            </a>
            <a class="carousel-control-next" href="#demo" data-slide="next">
              <span class="carousel-control-next-icon"></span>
            </a>
          </div>
        </div>

        <!-- Danh sách sản phẩm -->
        <div v-for="section in sections" :key="section.title" class="product__new">
          <h3 class="title-product">{{ section.title }}</h3>
          <div class="row">
            <div v-for="v in section.items" :key="v.id" class="col-lg-4 col-md-6 col-12 mb-20">
              <a @click="openDetail(v.id)" class="product__new-item">
                <div class="card">
                  <div>
                    <img class="card-img-top" :src="`http://localhost:8080/upload/images/${v.images.cd_Images}`" :alt="v.productID.name">
                  </div>
                  <div class="card-body">
                    <h5 class="card-title custom__name-product">{{ v.productID.name }}</h5>
                    <p class="card-text brand-color">Danh mục: {{ v.productID.categoryID.name }}</p>
                    <p class="card-text price-color product__price-new">{{ formatCurrency(v.price) }} VND</p>
                    <div class="status-product">
                      Trạng thái:
                      <b :class="v.status ? 'text-success' : 'text-danger'">{{ v.status ? 'Còn hàng' : 'Hết hàng' }}</b>
                    </div>
                    <div class="home-product-item__action">
                      <span class="home-product-item__like home-product-item__like--liked">
                        <i class="home-product-item__like-icon-empty far fa-heart"></i>
                        <i class="home-product-item__like-icon-fill fas fa-heart"></i>
                      </span>
                      <div class="home-product-item__rating">
                        <i v-for="star in 5" :key="star" :class="star <= v.rating ? 'home-product-item__star--gold fas fa-star' : 'fas fa-star'"></i>
                      </div>
                      <span class="home-product-item__sold">{{ v.sold }} đã bán</span>
                    </div>
                    <div class="sale-off" v-if="v.discount">
                      <span class="sale-off-percent">{{ v.discount }}%</span>
                      <span class="sale-off-label">GIẢM</span>
                    </div>
                  </div>
                </div>
              </a>
            </div>
          </div>
        </div>

        <!-- Chính sách -->
        <section class="awe-section-9">
          <div class="section_policy clearfix">
            <div class="col-12">
              <div class="owl-policy-mobile">
                <div class="owl-stage-outer">
                  <div class="owl-stage">
                    <div class="owl-item" v-for="(policy, index) in policies" :key="index">
                      <div class="section_policy_content">
                        <img :src="policy.img" alt="Policy Image"/>
                        <div class="section-policy-padding">
                          <h3>{{ policy.title }}</h3>
                          <div class="section_policy_title">{{ policy.subtitle }}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <h5>Thông tin liên hệ</h5>
            <p>Địa chỉ: 123 Đường ABC, Thành phố XYZ</p>
            <p>Điện thoại: (012) 345-6789</p>
            <p>Email: contact@example.com</p>
          </div>
          <div class="col-md-4">
            <h5>Liên kết nhanh</h5>
            <ul>
              <li><a href="/about">Giới thiệu</a></li>
              <li><a href="/products">Sản phẩm</a></li>
              <li><a href="/contact">Liên hệ</a></li>
              <li><a href="/policy">Chính sách</a></li>
            </ul>
          </div>
          <div class="col-md-4">
            <h5>Mạng xã hội</h5>
            <ul class="social-media">
              <li><a href="https://facebook.com" target="_blank">Facebook</a></li>
              <li><a href="https://twitter.com" target="_blank">Twitter</a></li>
              <li><a href="https://instagram.com" target="_blank">Instagram</a></li>
            </ul>
          </div>
        </div>
        <div class="text-center">
          <p>&copy; 2023 Công ty ABC. Bảo lưu mọi quyền.</p>
        </div>
      </div>
    </footer>

  </div>
</template>

<script>
import axios from "axios";

export default {
  data() {
    return {
      variations: [],
      policies: [],
      bestSellers: [],
      topSellers: [],
    };
  },
  computed: {
    sections() {
      return [
        { title: "Sản phẩm mới", items: this.variations },
        { title: "Sản phẩm bán chạy", items: this.bestSellers },
        { title: "Sản phẩm mới cập nhật", items: this.topSellers },
      ];
    },
  },
  mounted() {
    this.getProducts();
    this.getBestSellers();
    this.getTopSellers();
  },
  methods: {
    formatCurrency(value) {
      const number = Number(value);
      return isNaN(number) ? '0 ₫' : number.toLocaleString('vi-VN') + ' ₫';
    },
    openDetail(id) {
      sessionStorage.setItem("idvariation", id);
      this.$router.push({ path: `/product/${id}` });
    },
    processData(data) {
      return data.map(item => {
        item.productID.defaultImage = item.productID.imagesDTOS?.[0]?.cd_Images || "default.png";
        item.sold = item.sold || 0;
        return item;
      });
    },
    getProducts() {
      axios.get(`http://localhost:8080/MiniatureCrafts/new?page=1&size=3`)
          .then(response => {
            this.variations = this.processData(response.data.content || []);
          });
    },
    getBestSellers() {
      axios
          .get(`http://localhost:8080/MiniatureCrafts/bestseller`)
          .then((response) => {
            const data = this.processData(response.data.content || []);
            this.bestSellers = data.slice(0, 6);
          })
          .catch((error) => {
            console.error("Lỗi khi lấy danh sách sản phẩm bán chạy:", error);
          });
    },
    getTopSellers() {
      axios.get(`http://localhost:8080/MiniatureCrafts/new?page=0&size=6`)
          .then(response => {
            this.topSellers = this.processData(response.data.content || []);
          });
    },
  }
};
</script>

<style scoped>
body {
  background-color: #ffe0e0;
}

.container {
  width: 100%;
}

.card {
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  margin-bottom: 20px;
}

.card:hover {
  transform: translateY(-8px);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
}

.card-img-top {
  width: 100%;
  height: 200px;
  object-fit: contain;
  display: block;
  margin: auto;
}

.support-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #f8f2ec;
  padding: 18px 0;
  border-radius: 10px;
}

.support-item {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
  text-align: left;
  padding: 12px;
}

.support-item img {
  width: 45px;
  height: 45px;
  background-color: #000;
  padding: 12px;
  border-radius: 50%;
}

.social-media li {
  display: inline;
  margin-right: 18px;
}

.social-media li a {
  font-size: 20px;
  color: #007bff;
  transition: color 0.3s ease;
}

.social-media li a:hover {
  color: #0056b3;
}
</style>
